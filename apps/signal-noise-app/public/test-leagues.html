<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leagues & Teams Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/swr@2.2.5/dist/index.js"></script>
</head>
<body class="bg-gray-50">
    <div id="app" class="p-6">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-2xl font-bold mb-6">Sports Leagues & Teams</h2>
            <div id="loading" class="animate-pulse">
                <div class="h-8 bg-gray-200 rounded w-1/3 mb-4"></div>
                <div class="space-y-2">
                    <div class="h-4 bg-gray-200 rounded"></div>
                    <div class="h-4 bg-gray-200 rounded"></div>
                    <div class="h-4 bg-gray-200 rounded"></div>
                </div>
            </div>
            <div id="error" class="hidden text-red-600"></div>
            <div id="content" class="hidden">
                <!-- League Selection -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">Select League</h3>
                    <div id="league-buttons" class="flex flex-wrap gap-2">
                        <!-- League buttons will be inserted here -->
                    </div>
                </div>

                <!-- Letter Filter -->
                <div id="letter-filter" class="mb-6 hidden">
                    <h4 class="text-sm font-medium text-gray-700 mb-2">Filter by letter:</h4>
                    <div id="letter-buttons" class="flex flex-wrap gap-1">
                        <!-- Letter buttons will be inserted here -->
                    </div>
                </div>

                <!-- Teams Display -->
                <div id="teams-container">
                    <div class="mb-4 text-sm text-gray-600">
                        Showing <span id="teams-count">0</span> teams
                    </div>
                    <div id="teams-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Team cards will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedLeague = '';
        let selectedLetter = 'all';
        
        // Simple fetch function since we can't easily use SWR in plain HTML
        async function fetchData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network response was not ok');
                return await response.json();
            } catch (error) {
                console.error('Fetch error:', error);
                throw error;
            }
        }
        
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('content').classList.add('hidden');
        }
        
        function showError(message) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('content').classList.add('hidden');
            document.getElementById('error').textContent = 'Error: ' + message;
        }
        
        function showContent() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
        }
        
        function renderLeagues(leagues) {
            const container = document.getElementById('league-buttons');
            container.innerHTML = `
                <button onclick="selectLeague('')" class="px-4 py-2 rounded-lg transition-colors ${selectedLeague === '' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}">
                    All Leagues
                </button>
            `;
            
            leagues.forEach(league => {
                const button = document.createElement('button');
                button.className = `px-4 py-2 rounded-lg transition-colors flex items-center gap-2 ${selectedLeague === league.id ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                button.onclick = () => selectLeague(league.id);
                
                if (league.badge_path) {
                    const img = document.createElement('img');
                    img.src = league.badge_path;
                    img.alt = league.name;
                    img.className = 'w-5 h-5 rounded';
                    button.appendChild(img);
                }
                
                const text = document.createTextNode(league.name);
                button.appendChild(text);
                container.appendChild(button);
            });
        }
        
        function renderLetters(teams) {
            const letters = teams.length > 0 ? Array.from(new Set(
                teams.map(team => team.name?.charAt(0).toUpperCase()).filter(Boolean)
            )).sort() : [];
            
            if (letters.length === 0) {
                document.getElementById('letter-filter').classList.add('hidden');
                return;
            }
            
            document.getElementById('letter-filter').classList.remove('hidden');
            const container = document.getElementById('letter-buttons');
            container.innerHTML = `
                <button onclick="selectLetter('all')" class="px-3 py-1 text-sm rounded transition-colors ${selectedLetter === 'all' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}">
                    All
                </button>
            `;
            
            letters.forEach(letter => {
                const button = document.createElement('button');
                button.className = `px-3 py-1 text-sm rounded transition-colors ${selectedLetter === letter ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`;
                button.textContent = letter;
                button.onclick = () => selectLetter(letter);
                container.appendChild(button);
            });
        }
        
        function renderTeams(teams) {
            document.getElementById('teams-count').textContent = teams.length;
            const container = document.getElementById('teams-grid');
            
            if (teams.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500 col-span-full">No teams found for the selected criteria.</div>';
                return;
            }
            
            container.innerHTML = teams.map(team => `
                <div class="bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow">
                    <div class="flex items-center gap-3 mb-2">
                        ${team.badge_path ? `<img src="${team.badge_path}" alt="${team.name}" class="w-8 h-8 rounded">` : ''}
                        <h4 class="font-semibold text-gray-900">${team.name}</h4>
                    </div>
                    <div class="text-sm text-gray-600 space-y-1">
                        ${team.level ? `<div>League: ${team.level}</div>` : ''}
                        ${team.country ? `<div>Country: ${team.country}</div>` : ''}
                        ${team.founded ? `<div>Founded: ${team.founded}</div>` : ''}
                        ${team.estimated_value ? `<div>Value: ${team.estimated_value}</div>` : ''}
                        ${team.opportunity_score ? `
                            <div class="flex items-center gap-1">
                                <span>Opportunity Score:</span>
                                <div class="flex-1 bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: ${team.opportunity_score}%"></div>
                                </div>
                                <span class="text-xs">${team.opportunity_score}%</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        window.selectLeague = async (leagueId) => {
            selectedLeague = leagueId;
            await loadData();
        };
        
        window.selectLetter = async (letter) => {
            selectedLetter = letter;
            await loadData();
        };
        
        async function loadData() {
            try {
                showLoading();
                
                // Load leagues
                const leagues = await fetchData('/api/leagues');
                renderLeagues(leagues);
                
                // Load teams
                let teamsUrl = '/api/teams';
                const params = [];
                
                if (selectedLeague) params.push(`leagueId=${selectedLeague}`);
                if (selectedLetter !== 'all') params.push(`letter=${selectedLetter}`);
                
                if (params.length > 0) teamsUrl += '?' + params.join('&');
                
                const teamsData = await fetchData(teamsUrl);
                const teams = teamsData.teams || [];
                
                renderLetters(teams);
                renderTeams(teams);
                
                showContent();
            } catch (error) {
                showError(error.message);
            }
        }
        
        // Initial load
        loadData();
    </script>
</body>
</html>