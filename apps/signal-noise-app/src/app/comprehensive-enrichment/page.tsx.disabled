"use client"

import { useState, useEffect, useCallback } from "react"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Progress } from "@/components/ui/progress"
import { ScrollArea } from "@/components/ui/scroll-area"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { 
  Brain, 
  Zap, 
  Database, 
  BarChart3, 
  Clock, 
  CheckCircle, 
  AlertCircle, 
  Pause,
  Play,
  RefreshCw,
  Download,
  ExternalLink,
  Target
} from "lucide-react"

interface EnrichmentLog {
  id: string
  timestamp: string
  level: 'info' | 'success' | 'warning' | 'error'
  message: string
  entityName?: string
  entityType?: string
  details?: any
}

interface EnrichmentResult {
  entityId: string
  entityName: string
  entityType: string
  status: 'pending' | 'processing' | 'completed' | 'failed'
  opportunityScore?: number
  digitalMaturity?: string
  insights?: string[]
  processingTime: number
  error?: string
  aiAnalysis?: {
    claude: any
    perplexity: any
  }
}

interface EnrichmentSummary {
  totalEntities: number
  processed: number
  completed: number
  failed: number
  inProgress: number
  avgProcessingTime: number
  topOpportunities: EnrichmentResult[]
  entityTypeStats: {
    [key: string]: {
      total: number
      completed: number
      avgScore: number
    }
  }
}

export default function ComprehensiveEnrichmentPage() {
  const [isRunning, setIsRunning] = useState(false)
  const [isPaused, setIsPaused] = useState(false)
  const [progress, setProgress] = useState(0)
  const [logs, setLogs] = useState<EnrichmentLog[]>([])
  const [results, setResults] = useState<EnrichmentResult[]>([])
  const [summary, setSummary] = useState<EnrichmentSummary | null>(null)
  const [batchSize, setBatchSize] = useState(3)
  const [processingSpeed, setProcessingSpeed] = useState<'normal' | 'fast'>('normal')
  
  const addLog = useCallback((level: EnrichmentLog['level'], message: string, entityName?: string, entityType?: string, details?: any) => {
    const newLog: EnrichmentLog = {
      id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
      timestamp: new Date().toLocaleTimeString(),
      level,
      message,
      entityName,
      entityType,
      details
    }
    setLogs(prev => [...prev, newLog])
  }, [])
  
  const clearLogs = useCallback(() => {
    setLogs([])
    addLog('info', 'Logs cleared')
  }, [addLog])
  
  const startEnrichment = useCallback(async () => {
    setIsRunning(true)
    setIsPaused(false)
    setProgress(0)
    setResults([])
    setSummary(null)
    addLog('info', 'üöÄ Starting comprehensive entity enrichment...', undefined, undefined, {
      batchSize,
      processingSpeed,
      timestamp: new Date().toISOString()
    })
    
    try {
      // Get batch information from new API
      addLog('info', 'üìä Fetching entities and creating processing batches...')
      const batchResponse = await fetch('/api/batch-process', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          entity_types: ['club', 'league', 'organization', 'person'],
          batch_size: batchSize,
          include_claude_analysis: true,
          include_perplexity_research: true,
          include_brightdata_scraping: false
        })
      })
      
      const batchData = await batchResponse.json()
      
      if (!batchData.success) {
        throw new Error(batchData.error || 'Failed to create batches')
      }
      
      const { batch_info } = batchData
      addLog('success', `‚úÖ Created ${batch_info.total_batches} batches for ${batch_info.total_entities} entities`, undefined, undefined, {
        entityTypes: batch_info.entities_by_type,
        total: batch_info.total_entities,
        batches: batch_info.total_batches
      })
      
      addLog('info', 'üìã Entity distribution:', undefined, undefined, batch_info.entities_by_type)
      
      // Process entities using the batch structure
      const enrichmentResults: EnrichmentResult[] = []
      const typeStats: any = {}
      
      // Initialize type stats
      Object.keys(batch_info.entities_by_type).forEach(entityType => {
        typeStats[entityType] = {
          total: batch_info.entities_by_type[entityType],
          completed: 0,
          scores: []
        }
      })
      
      // Process each batch
      for (const batch of batch_info.batches) {
        if (!isRunning || isPaused) {
          addLog('warning', '‚è∏Ô∏è Processing paused or stopped')
          break
        }
        
        addLog('info', `üì¶ Processing batch ${batch.batch_number}/${batch_info.total_batches} (${batch.entity_count} entities)`, undefined, undefined, {
          batchEntities: batch.entities.map(e => `${e.name} (${e.type})`)
        })
        
        // Process each entity in the batch individually
        const batchResults: EnrichmentResult[] = []
        
        for (const entity of batch.entities) {
          if (!isRunning || isPaused) break
          
          addLog('info', `üß† Enriching ${entity.name} (${entity.type})`, entity.name, entity.type)
          
          try {
            const enrichmentResponse = await fetch('/api/enrich-entity', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                entity_id: entity.neo4j_id,
                entity_type: entity.type,
                entity_name: entity.name,
                enrichment_options: {
                  include_claude_analysis: true,
                  include_perplexity_research: true,
                  include_brightdata_scraping: false
                }
              })
            })
            
            const enrichmentData = await enrichmentResponse.json()
            
            if (enrichmentData.success) {
              const result: EnrichmentResult = {
                entityId: entity.neo4j_id,
                entityName: entity.name,
                entityType: entity.type,
                status: 'completed',
                opportunityScore: enrichmentData.enrichment_results?.composite_scores?.opportunity_score || 0,
                digitalMaturity: enrichmentData.enrichment_results?.claude_analysis?.digital_maturity || 'LOW',
                processingTime: enrichmentData.processing_time_ms || 0,
                aiAnalysis: {
                  claude: enrichmentData.enrichment_results?.claude_analysis,
                  perplexity: enrichmentData.enrichment_results?.perplexity_research
                }
              }
              
              batchResults.push(result)
              enrichmentResults.push(result)
              
              // Update type stats
              if (typeStats[entity.type]) {
                typeStats[entity.type].scores.push(result.opportunityScore || 0)
              }
              
              addLog('success', `‚úÖ ${entity.name} enriched - Score: ${result.opportunityScore}, Maturity: ${result.digitalMaturity} (${result.processingTime}ms)`, entity.name, entity.type, {
                opportunityScore: result.opportunityScore,
                digitalMaturity: result.digitalMaturity,
                processingTime: result.processingTime
              })
              
            } else {
              const result: EnrichmentResult = {
                entityId: entity.neo4j_id,
                entityName: entity.name,
                entityType: entity.type,
                status: 'failed',
                processingTime: 0,
                error: enrichmentData.error || 'Unknown error'
              }
              
              batchResults.push(result)
              enrichmentResults.push(result)
              
              addLog('error', `‚ùå ${entity.name} enrichment failed: ${result.error}`, entity.name, entity.type)
            }
            
          } catch (error) {
            const result: EnrichmentResult = {
              entityId: entity.neo4j_id,
              entityName: entity.name,
              entityType: entity.type,
              status: 'failed',
              processingTime: 0,
              error: error instanceof Error ? error.message : 'Network error'
            }
            
            batchResults.push(result)
            enrichmentResults.push(result)
            
            addLog('error', `‚ùå ${entity.name} enrichment failed: ${result.error}`, entity.name, entity.type)
          }
        
        // Update completed counts and progress
        const totalProcessed = enrichmentResults.length
        const overallProgress = (totalProcessed / batch_info.total_entities) * 100
        setProgress(overallProgress)
        
        // Update type stats
        Object.keys(typeStats).forEach(entityType => {
          typeStats[entityType].completed = typeStats[entityType].scores.length
          typeStats[entityType].avgScore = typeStats[entityType].scores.length > 0 
            ? typeStats[entityType].scores.reduce((a: number, b: number) => a + b, 0) / typeStats[entityType].scores.length 
            : 0
        })
        
        // Update summary
        const summaryData = generateSummary(enrichmentResults, batch_info.total_entities, typeStats)
        setSummary(summaryData)
        
        addLog('success', `‚úÖ Batch ${batch.batch_number} completed: ${batchResults.filter(r => r.status === 'completed').length}/${batch.entity_count} entities enriched`, undefined, undefined, {
          batchNumber: batch.batch_number,
          batchResults: batchResults.map(r => ({ name: r.entityName, status: r.status, score: r.opportunityScore }))
        })
        
        // Add results to state
        setResults(prev => [...prev, ...batchResults])
        
        // Small delay to show progress
        await new Promise(resolve => setTimeout(resolve, 1000))
      }
      
      // Final summary
      const finalSummary = generateSummary(enrichmentResults, batch_info.total_entities, typeStats)
      setSummary(finalSummary)
      
      addLog('success', 'üéä Comprehensive enrichment completed!', undefined, undefined, finalSummary)
      addLog('info', `üìä Final Results: ${finalSummary.completed}/${finalSummary.totalEntities} entities enriched successfully`, undefined, undefined, {
        successRate: ((finalSummary.completed / finalSummary.totalEntities) * 100).toFixed(1) + '%',
        averageScore: finalSummary.avgProcessingTime.toFixed(0) + 'ms per entity'
      });
      
    } catch (error) {
      addLog('error', `‚ùå Enrichment failed: ${error.message}`);
    } finally {
      setIsRunning(false);
    }
  }, [batchSize, processingSpeed, isRunning, isPaused, addLog]);
  
  const enrichEntityBatch = async (entities: any[], entityType: string): Promise<EnrichmentResult[]> => {
    const batchResults: EnrichmentResult[] = []
    
    for (const entity of entities) {
      const startTime = Date.now()
      const result: EnrichmentResult = {
        entityId: entity.id,
        entityName: entity.properties.name,
        entityType: entityType,
        status: 'processing',
        processingTime: 0
      }
      
      try {
        addLog('info', `üß† Enriching ${entity.properties.name} (${entityType})`, entity.properties.name, entityType)
        
        // Call AI enrichment API
        const enrichmentResponse = await fetch('/api/enrich-entity', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            entity: entity,
            entityType,
            includeClaude: true,
            includePerplexity: true
          })
        })
        
        if (enrichmentResponse.ok) {
          const enrichmentData = await enrichmentResponse.json()
          
          result.status = 'completed'
          result.processingTime = Date.now() - startTime
          result.opportunityScore = enrichmentData.opportunityScore
          result.digitalMaturity = enrichmentData.digitalMaturity
          result.insights = enrichmentData.insights
          result.aiAnalysis = enrichmentData.aiAnalysis
          
          addLog('success', `‚úÖ ${entity.properties.name} enriched - Score: ${result.opportunityScore}`, entity.properties.name, entityType, {
            score: result.opportunityScore,
            insights: enrichmentData.insights?.slice(0, 2)
          })
        } else {
          throw new Error(`API error: ${enrichmentResponse.status}`)
        }
        
      } catch (error) {
        result.status = 'failed'
        result.error = error.message
        result.processingTime = Date.now() - startTime
        
        addLog('error', `‚ùå Failed to enrich ${entity.properties.name}: ${error.message}`, entity.properties.name, entityType)
      }
      
      batchResults.push(result)
    }
    
    return batchResults
  }
  
  const generateSummary = (results: EnrichmentResult[], allEntities: any[], typeStats: any): EnrichmentSummary => {
    const completed = results.filter(r => r.status === 'completed').length
    const failed = results.filter(r => r.status === 'failed').length
    const inProgress = results.filter(r => r.status === 'processing').length
    
    const avgProcessingTime = results.length > 0 
      ? results.reduce((sum, r) => sum + r.processingTime, 0) / results.length 
      : 0
    
    const topOpportunities = results
      .filter(r => r.status === 'completed' && r.opportunityScore)
      .sort((a, b) => (b.opportunityScore || 0) - (a.opportunityScore || 0))
      .slice(0, 5)
    
    return {
      totalEntities: allEntities.length,
      processed: results.length,
      completed,
      failed,
      inProgress,
      avgProcessingTime,
      topOpportunities,
      entityTypeStats: typeStats
    }
  }
  
  const pauseEnrichment = () => {
    setIsPaused(true)
    addLog('warning', '‚è∏Ô∏è Enrichment paused')
  }
  
  const resumeEnrichment = () => {
    setIsPaused(false)
    addLog('info', '‚ñ∂Ô∏è Enrichment resumed')
  }
  
  const stopEnrichment = () => {
    setIsRunning(false)
    setIsPaused(false)
    addLog('warning', 'üõë Enrichment stopped')
  }
  
  const exportResults = () => {
    const exportData = {
      summary,
      results,
      logs,
      exportDate: new Date().toISOString(),
      config: {
        batchSize,
        processingSpeed
      }
    }
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `enrichment-results-${new Date().toISOString().split('T')[0]}.json`
    document.body.appendChild(a)
    a.click()
    document.body.removeChild(a)
    URL.revokeObjectURL(url)
    
    addLog('info', 'üì§ Results exported')
  }
  
  const getLogIcon = (level: EnrichmentLog['level']) => {
    switch (level) {
      case 'success': return <CheckCircle className="h-4 w-4 text-green-500" />
      case 'warning': return <AlertCircle className="h-4 w-4 text-yellow-500" />
      case 'error': return <AlertCircle className="h-4 w-4 text-red-500" />
      default: return <Database className="h-4 w-4 text-blue-500" />
    }
  }
  
  return (
    <div className="min-h-screen bg-background">
      {/* Header */}
      <div className="border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div className="container mx-auto px-4 py-6">
          <div className="flex items-center gap-4 mb-4">
            <div className="flex items-center gap-2">
              <Brain className="h-8 w-8 text-primary" />
              <h1 className="text-3xl font-bold">Comprehensive Entity Enrichment</h1>
            </div>
            <Badge variant="secondary" className="ml-auto">
              {summary ? `${summary.completed}/${summary.totalEntities} Enriched` : 'Ready to Start'}
            </Badge>
          </div>
          <p className="text-muted-foreground">
            AI-powered enrichment of all entities in the knowledge graph with Claude Agent and Perplexity analysis
          </p>
        </div>
      </div>

      <div className="container mx-auto px-4 py-8">
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
          {/* Control Panel */}
          <div className="lg:col-span-1">
            <Card className="mb-6">
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Zap className="h-5 w-5" />
                  Control Panel
                </CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* Configuration */}
                <div>
                  <label className="text-sm font-medium mb-2 block">Batch Size</label>
                  <select
                    value={batchSize}
                    onChange={(e) => setBatchSize(Number(e.target.value))}
                    disabled={isRunning}
                    className="w-full p-2 border rounded-md bg-background"
                  >
                    <option value={1}>1 entity (Very Safe)</option>
                    <option value={3}>3 entities (Recommended)</option>
                    <option value={5}>5 entities (Fast)</option>
                  </select>
                </div>
                
                <div>
                  <label className="text-sm font-medium mb-2 block">Processing Speed</label>
                  <select
                    value={processingSpeed}
                    onChange={(e) => setProcessingSpeed(e.target.value as 'normal' | 'fast')}
                    disabled={isRunning}
                    className="w-full p-2 border rounded-md bg-background"
                  >
                    <option value="normal">Normal (Thorough)</option>
                    <option value="fast">Fast (Optimized)</option>
                  </select>
                </div>
                
                {/* Control Buttons */}
                <div className="space-y-2">
                  {!isRunning ? (
                    <Button
                      onClick={startEnrichment}
                      className="w-full"
                      size="lg"
                    >
                      <Play className="h-4 w-4 mr-2" />
                      Start Enrichment
                    </Button>
                  ) : isPaused ? (
                    <Button
                      onClick={resumeEnrichment}
                      className="w-full"
                      size="lg"
                    >
                      <Play className="h-4 w-4 mr-2" />
                      Resume
                    </Button>
                  ) : (
                    <Button
                      onClick={pauseEnrichment}
                      variant="outline"
                      className="w-full"
                      size="lg"
                    >
                      <Pause className="h-4 w-4 mr-2" />
                      Pause
                    </Button>
                  )}
                  
                  {isRunning && (
                    <Button
                      onClick={stopEnrichment}
                      variant="destructive"
                      className="w-full"
                    >
                      <RefreshCw className="h-4 w-4 mr-2" />
                      Stop
                    </Button>
                  )}
                  
                  <Button
                    onClick={exportResults}
                    variant="outline"
                    className="w-full"
                    disabled={results.length === 0}
                  >
                    <Download className="h-4 w-4 mr-2" />
                    Export Results
                  </Button>
                </div>
              </CardContent>
            </Card>
            
            {/* Progress */}
            {isRunning && (
              <Card className="mb-6">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <BarChart3 className="h-5 w-5" />
                    Progress
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span>Overall Progress</span>
                      <span>{progress.toFixed(1)}%</span>
                    </div>
                    <Progress value={progress} className="h-2" />
                    <div className="text-xs text-muted-foreground">
                      {summary ? `${summary.completed}/${summary.totalEntities} entities` : 'Initializing...'}
                    </div>
                  </div>
                </CardContent>
              </Card>
            )}
            
            {/* Quick Stats */}
            {summary && (
              <Card>
                <CardHeader>
                  <CardTitle className="flex items-center gap-2">
                    <Target className="h-5 w-5" />
                    Live Statistics
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-2 text-sm">
                    <div className="flex justify-between">
                      <span>Completed:</span>
                      <span className="font-medium">{summary.completed}/{summary.totalEntities}</span>
                    </div>
                    <div className="flex justify-between">
                      <span>Success Rate:</span>
                      <span className="font-medium">{((summary.completed / summary.totalEntities) * 100).toFixed(1)}%</span>
                    </div>
                    <div className="flex justify-between">
                      <span>Avg Time:</span>
                      <span className="font-medium">{summary.avgProcessingTime.toFixed(0)}ms</span>
                    </div>
                    <div className="flex justify-between">
                      <span>Failed:</span>
                      <span className="font-medium text-red-500">{summary.failed}</span>
                    </div>
                  </div>
                </CardContent>
              </Card>
            )}
          </div>
          
          {/* Main Content */}
          <div className="lg:col-span-2">
            <Tabs defaultValue="logs" className="w-full">
              <TabsList className="grid w-full grid-cols-4">
                <TabsTrigger value="logs">Live Logs</TabsTrigger>
                <TabsTrigger value="results">Results</TabsTrigger>
                <TabsTrigger value="top-opportunities">Top Opportunities</TabsTrigger>
                <TabsTrigger value="entity-types">Entity Types</TabsTrigger>
              </TabsList>
              
              <TabsContent value="logs" className="space-y-4">
                <Card>
                  <CardHeader className="flex flex-row items-center justify-between">
                    <CardTitle className="flex items-center gap-2">
                      <Clock className="h-5 w-5" />
                      Live Processing Logs
                    </CardTitle>
                    <Button
                      variant="outline"
                      size="sm"
                      onClick={clearLogs}
                    >
                      Clear Logs
                    </Button>
                  </CardHeader>
                  <CardContent>
                    <ScrollArea className="h-[600px] w-full border rounded-md p-4">
                      <div className="space-y-2">
                        {logs.map((log) => (
                          <div
                            key={log.id}
                            className={`flex items-start gap-3 p-3 rounded-md ${
                              log.level === 'error' ? 'bg-red-50 border-red-200' :
                              log.level === 'warning' ? 'bg-yellow-50 border-yellow-200' :
                              log.level === 'success' ? 'bg-green-50 border-green-200' :
                              'bg-blue-50 border-blue-200'
                            }`}
                          >
                            {getLogIcon(log.level)}
                            <div className="flex-1 min-w-0">
                              <div className="flex items-center gap-2 text-sm">
                                <span className="font-mono text-xs text-muted-foreground">
                                  {log.timestamp}
                                </span>
                                {log.entityName && (
                                  <>
                                    <span className="text-muted-foreground">‚Ä¢</span>
                                    <span className="font-medium">{log.entityName}</span>
                                    {log.entityType && (
                                      <Badge variant="outline" className="text-xs">
                                        {log.entityType}
                                      </Badge>
                                    )}
                                  </>
                                )}
                              </div>
                              <p className="text-sm mt-1">{log.message}</p>
                              {log.details && (
                                <details className="mt-2">
                                  <summary className="text-xs text-muted-foreground cursor-pointer">
                                    View details
                                  </summary>
                                  <pre className="text-xs bg-muted p-2 rounded mt-1 overflow-x-auto">
                                    {JSON.stringify(log.details, null, 2)}
                                  </pre>
                                </details>
                              )}
                            </div>
                          </div>
                        ))}
                        {logs.length === 0 && (
                          <div className="text-center text-muted-foreground py-8">
                            No logs yet. Start enrichment to see progress.
                          </div>
                        )}
                      </div>
                    </ScrollArea>
                  </CardContent>
                </Card>
              </TabsContent>
              
              <TabsContent value="results" className="space-y-4">
                <Card>
                  <CardHeader>
                    <CardTitle>Enrichment Results</CardTitle>
                  </CardHeader>
                  <CardContent>
                    <div className="space-y-2">
                      {results.map((result) => (
                        <div
                          key={result.entityId}
                          className="flex items-center justify-between p-3 border rounded-md"
                        >
                          <div className="flex items-center gap-3">
                            {result.status === 'completed' ? (
                              <CheckCircle className="h-4 w-4 text-green-500" />
                            ) : result.status === 'failed' ? (
                              <AlertCircle className="h-4 w-4 text-red-500" />
                            ) : (
                              <RefreshCw className="h-4 w-4 text-blue-500 animate-spin" />
                            )}
                            <div>
                              <div className="font-medium">{result.entityName}</div>
                              <div className="text-sm text-muted-foreground">
                                {result.entityType} ‚Ä¢ {result.processingTime}ms
                              </div>
                            </div>
                          </div>
                          <div className="text-right">
                            {result.status === 'completed' && result.opportunityScore && (
                              <div className="space-y-1">
                                <Badge variant="default">
                                  Score: {result.opportunityScore}
                                </Badge>
                                <div className="text-xs text-muted-foreground">
                                  {result.digitalMaturity}
                                </div>
                              </div>
                            )}
                            {result.status === 'failed' && (
                              <Badge variant="destructive">
                                Failed
                              </Badge>
                            )}
                          </div>
                        </div>
                      ))}
                      {results.length === 0 && (
                        <div className="text-center text-muted-foreground py-8">
                          No results yet. Start enrichment to see results.
                        </div>
                      )}
                    </div>
                  </CardContent>
                </Card>
              </TabsContent>
              
              <TabsContent value="top-opportunities" className="space-y-4">
                <Card>
                  <CardHeader>
                    <CardTitle>Top Business Opportunities</CardTitle>
                  </CardHeader>
                  <CardContent>
                    {summary && summary.topOpportunities.length > 0 ? (
                      <div className="space-y-3">
                        {summary.topOpportunities.map((opportunity, index) => (
                          <div
                            key={opportunity.entityId}
                            className="flex items-center justify-between p-4 border rounded-md bg-gradient-to-r from-blue-50 to-purple-50"
                          >
                            <div className="flex items-center gap-3">
                              <div className="text-2xl font-bold text-primary">
                                #{index + 1}
                              </div>
                              <div>
                                <div className="font-semibold">{opportunity.entityName}</div>
                                <div className="text-sm text-muted-foreground">
                                  {opportunity.entityType} ‚Ä¢ {opportunity.processingTime}ms
                                </div>
                                {opportunity.insights && opportunity.insights.length > 0 && (
                                  <div className="text-xs text-muted-foreground mt-1">
                                    üí° {opportunity.insights[0]}
                                  </div>
                                )}
                              </div>
                            </div>
                            <div className="text-right">
                              <div className="text-2xl font-bold text-green-600">
                                {opportunity.opportunityScore}
                              </div>
                              <div className="text-xs text-muted-foreground">
                                Opportunity Score
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center text-muted-foreground py-8">
                        No opportunities yet. Start enrichment to see results.
                      </div>
                    )}
                  </CardContent>
                </Card>
              </TabsContent>
              
              <TabsContent value="entity-types" className="space-y-4">
                <Card>
                  <CardHeader>
                    <CardTitle>Entity Type Breakdown</CardTitle>
                  </CardHeader>
                  <CardContent>
                    {summary && summary.entityTypeStats ? (
                      <div className="space-y-3">
                        {Object.entries(summary.entityTypeStats).map(([type, stats]: [string, any]) => (
                          <div key={type} className="flex items-center justify-between p-3 border rounded-md">
                            <div>
                              <div className="font-semibold capitalize">{type}</div>
                              <div className="text-sm text-muted-foreground">
                                {stats.completed}/{stats.total} completed
                              </div>
                            </div>
                            <div className="text-right">
                              <div className="text-lg font-bold text-blue-600">
                                {stats.avgScore.toFixed(1)}
                              </div>
                              <div className="text-xs text-muted-foreground">
                                Avg Score
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className="text-center text-muted-foreground py-8">
                        No entity type statistics yet. Start enrichment to see results.
                      </div>
                    )}
                  </CardContent>
                </Card>
              </TabsContent>
            </Tabs>
          </div>
        </div>
      </div>
    </div>
  )
}